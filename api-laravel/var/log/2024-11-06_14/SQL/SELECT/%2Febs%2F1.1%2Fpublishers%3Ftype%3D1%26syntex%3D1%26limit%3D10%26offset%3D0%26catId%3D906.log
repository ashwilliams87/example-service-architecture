[2024-11-06 14:40:19 1730904019.3132] sql (not cache): [Time: 18 ms Mem: 0 B (peak: 34 MB)]  SELECT SQL_NO_CACHE `User`.`id` AS `user_pk`, `User`.`enabled` AS `user_active`, `User`.`last_login` AS `last_login`, `User`.`expires_at` AS `user_expired_at`, `User`.`roles`, `User`.`created_at` AS `created_at`, `User`.`updated_at` AS `updated_at`, `User`.`firstname` AS `user_name`, `User`.`subscriber_id` AS `subscriber__fk`, `User`.`patronymic`, `User`.`publisher_id` AS `publisher__fk`, `User`.`user_comment`, `User`.`warn_count`, `User`.`archive_vkr_id` AS `archive_vkr__fk`, `User`.`subdivision_id` AS `subdivision__fk`, `User`.`app_used`, `User`.`app_registration`, `User`.`try_discipline_count`, `User`.`last_new_at` AS `last_new_at`, `User`.`cabinet_settings__json`, `User`.`previous_subscriber_id`, `User`.`security_user_id` AS `security_user__fk` FROM `ebs`.`fos_user_user` `User` WHERE `User`.`security_user_id` = ?  ("14901811") result: 'numRows' => 1, 'affectedRows' => 0, 'foundRows' => 1, 'insertId' => 

[2024-11-06 14:40:19 1730904019.3322] sql (new - Cacher): [Time: 16 ms Mem: 0 B (peak: 34 MB)]  SELECT roles FROM `ebs`.`fos_user_user_group` `User_Group` INNER JOIN `ebs`.`fos_user_group` `Group` ON (`User_Group`.`group_id` = `Group`.`id`) WHERE `User_Group`.`user_id` = ?  ("10121529") result: 'numRows' => 0, 'affectedRows' => 0, 'foundRows' => 0, 'insertId' => 

[2024-11-06 14:40:19 1730904019.3687] sql (new - Cacher): [Time: 15 ms Mem: 0 B (peak: 34 MB)]  SELECT `Subscriber`.`id` AS `subscriber_pk`, `Subscriber`.`subscriber_name`, `Subscriber`.`subscriber_active`, `Subscriber`.`subscriber_id` AS `subscriber__fk`, `Subscriber`.`access_type_id` AS `access_type__fk`, `Subscriber`.`subscriber_type_id` AS `subscriber_type__fk`, `Subscriber`.`fio`, `Subscriber`.`email`, `Subscriber`.`post`, `Subscriber`.`phone`, `Subscriber`.`private_name`, `Subscriber`.`city_id` AS `city__fk`, `Subscriber`.`create_time` AS `create_time`, `Subscriber`.`subscriber_comment`, `Subscriber`.`head_access`, `Subscriber`.`reader_detail`, `Subscriber`.`contragent_id` AS `contragent__fk`, `Subscriber`.`fedurus_organization_name`, `Subscriber`.`code_1c`, `Subscriber`.`secret_key`, `Subscriber`.`secret_key_date` AS `secret_key_date`, `Subscriber`.`subscriber_created_at` AS `subscriber_created_at`, `Subscriber`.`send_registration_request`, `Subscriber`.`education_level_id` AS `education_level__fk`, `Subscriber`.`subscriber_account_ip__json`, `Subscriber`.`domain`, `Subscriber`.`auto_confirmation`, `Subscriber`.`subscriber_settings__json`, `Subscriber`.`moodle_login_url` FROM `ebs`.`ebs_subscriber` `Subscriber` INNER JOIN `ebs`.`fos_user_user` `User` ON (`User`.`subscriber_id` = `Subscriber`.`id`) WHERE `User`.`id` = ?  ("10121529") result: 'numRows' => 1, 'affectedRows' => 0, 'foundRows' => 1, 'insertId' => 

[2024-11-06 14:40:19 1730904019.4605] sql (new - Cacher): [Time: 44 ms Mem: 2 MB (peak: 36 MB)]  SELECT DISTINCT SQL_CALC_FOUND_ROWS COUNT(DISTINCT CASE WHEN (Book.book_expired>"2024-11-06" AND Book.book_private=0) OR Available.access_id IS NOT NULL THEN Book.id ELSE NULL END) AS `all_count`, MAX(Book.book_expired) AS `expired`, MAX(CASE WHEN Available.access_id IS NULL THEN 0 ELSE 1 END) AS `available`, `Book`.`book_private`, `Publisher`.`id`, `Publisher`.`publisher_name` AS `title` FROM `ebs`.`ebs_book` `Book` INNER JOIN `ebs`.`ebs_publisher` `Publisher` ON (Publisher.id=Book.publisher_id AND Publisher.publisher_active=1) INNER JOIN `ebs`.`ebs_book_category_link` `Book_Category_Link` ON (Book_Category_Link.book_id=Book.id) INNER JOIN `ebs`.`ebs_category` `Category` ON ((Category.id=Book_Category_Link.category_id) AND (Category.category_active=1)) INNER JOIN `ebs`.`ebs_category` `Area_Knowledge` ON (Area_Knowledge.id=Category.area_knowledge_id AND Area_Knowledge.area_knowledge_id=906 AND Area_Knowledge.category_active=1) LEFT JOIN (( SELECT `Access_Dynamic_Denormal`.`id` AS `access_id`, `Book`.`id` AS `book_id` FROM `ebs`.`ebs_access_dynamic_denormal` `Access_Dynamic_Denormal` INNER JOIN `ebs`.`ebs_book` `Book` ON (Book.publisher_id=Access_Dynamic_Denormal.publisher_id AND Book.area_knowledge_id=Access_Dynamic_Denormal.area_knowledge_id AND Book.book_expired>=Access_Dynamic_Denormal.start_date) INNER JOIN `ebs`.`ebs_publisher` `Publisher` ON (Publisher.id=Book.publisher_id AND Publisher.publisher_active=1) INNER JOIN `ebs`.`ebs_book_category_link` `Book_Category_Link` ON (Book_Category_Link.book_id=Book.id) INNER JOIN `ebs`.`ebs_category` `Category` ON ((Category.id=Book_Category_Link.category_id) AND (Category.category_active=1)) INNER JOIN `ebs`.`ebs_category` `Area_Knowledge` ON (Area_Knowledge.id=Category.area_knowledge_id AND Area_Knowledge.area_knowledge_id=906 AND Area_Knowledge.category_active=1) WHERE "2024-11-06" BETWEEN Access_Dynamic_Denormal.start_date AND Access_Dynamic_Denormal.expired_date AND Access_Dynamic_Denormal.private=0 AND Access_Dynamic_Denormal.subscriber_id IN (4) AND (Book.book_platform_id=2 OR Book.book_platform_id IS NULL) AND Book.synthesizer_path IS NOT NULL AND Book.book_private=0 AND Book.extra=0 AND Book.book_active=1 GROUP BY `Book`.`id` ) UNION ALL ( SELECT `Access_Dynamic_Denormal`.`id` AS `access_id`, `Book`.`id` AS `book_id` FROM `ebs`.`ebs_access_dynamic_denormal` `Access_Dynamic_Denormal` INNER JOIN `ebs`.`ebs_book` `Book` ON (Book.publisher_id=Access_Dynamic_Denormal.publisher_id AND Book.area_knowledge_id=Access_Dynamic_Denormal.area_knowledge_id AND Book.book_expired>=Access_Dynamic_Denormal.start_date) INNER JOIN `ebs`.`ebs_publisher` `Publisher` ON (Publisher.id=Book.publisher_id AND Publisher.publisher_active=1) INNER JOIN `ebs`.`ebs_book_category_link` `Book_Category_Link` ON (Book_Category_Link.book_id=Book.id) INNER JOIN `ebs`.`ebs_category` `Category` ON ((Category.id=Book_Category_Link.category_id) AND (Category.category_active=1)) INNER JOIN `ebs`.`ebs_category` `Area_Knowledge` ON (Area_Knowledge.id=Category.area_knowledge_id AND Area_Knowledge.area_knowledge_id=906 AND Area_Knowledge.category_active=1) WHERE "2024-11-06" BETWEEN Access_Dynamic_Denormal.start_date AND Access_Dynamic_Denormal.expired_date AND Access_Dynamic_Denormal.private=1 AND Access_Dynamic_Denormal.subscriber_id IN (4) AND (Book.book_platform_id=2 OR Book.book_platform_id IS NULL) AND Book.synthesizer_path IS NOT NULL AND Book.book_private=1 AND Book.extra=0 AND Book.book_active=1 GROUP BY `Book`.`id` ) UNION ALL ( SELECT DISTINCT `Access_Book_Static`.`id` AS `access_id`, `Book`.`id` AS `book_id` FROM `ebs`.`ebs_access_book_static` `Access_Book_Static` INNER JOIN `ebs`.`ebs_packet_static` `Packet_Static` ON (Access_Book_Static.packet_static_id=Packet_Static.id AND "2024-11-06" BETWEEN Access_Book_Static.start_date AND Access_Book_Static.expired_date AND Access_Book_Static.subscriber_id IN (4)) INNER JOIN `ebs`.`ebs_packet_static_book_link` `Packet_Static_Book_Link` ON (Packet_Static_Book_Link.packet_static_id=Packet_Static.id) INNER JOIN `ebs`.`ebs_book` `Book` ON (Book.id=Packet_Static_Book_Link.book_id AND CONCAT(Book.book_expired," 23:59:59") >= Access_Book_Static.start_date) INNER JOIN `ebs`.`ebs_publisher` `Publisher` ON (Publisher.id=Book.publisher_id AND Publisher.publisher_active=1) INNER JOIN `ebs`.`ebs_book_category_link` `Book_Category_Link` ON (Book_Category_Link.book_id=Book.id) INNER JOIN `ebs`.`ebs_category` `Category` ON ((Category.id=Book_Category_Link.category_id) AND (Category.category_active=1)) INNER JOIN `ebs`.`ebs_category` `Area_Knowledge` ON (Area_Knowledge.id=Category.area_knowledge_id AND Area_Knowledge.area_knowledge_id=906 AND Area_Knowledge.category_active=1) INNER JOIN `ebs`.`ebs_packet_dynamic` `Packet_Dynamic` ON (Packet_Dynamic.category_id=Area_Knowledge.id AND Packet_Dynamic.publisher_id=Publisher.id) WHERE (Book.book_platform_id=2 OR Book.book_platform_id IS NULL) AND Book.synthesizer_path IS NOT NULL AND Book.book_private=0 AND Book.extra=0 AND Book.book_active=1 ) UNION ALL ( SELECT DISTINCT `Access_Book_Gift`.`id` AS `access_id`, `Book`.`id` AS `book_id` FROM `ebs`.`ebs_access_book_gift` `Access_Book_Gift` INNER JOIN `ebs`.`ebs_book` `Book` ON (Book.id=Access_Book_Gift.book_id AND Book.book_expired>=Access_Book_Gift.start_date) INNER JOIN `ebs`.`ebs_publisher` `Publisher` ON (Publisher.id=Book.publisher_id AND Publisher.publisher_active=1) INNER JOIN `ebs`.`ebs_book_category_link` `Book_Category_Link` ON (Book_Category_Link.book_id=Book.id) INNER JOIN `ebs`.`ebs_category` `Category` ON ((Category.id=Book_Category_Link.category_id) AND (Category.category_active=1)) INNER JOIN `ebs`.`ebs_category` `Area_Knowledge` ON (Area_Knowledge.id=Category.area_knowledge_id AND Area_Knowledge.area_knowledge_id=906 AND Area_Knowledge.category_active=1) WHERE Access_Book_Gift.user_id=10121529 AND "2024-11-06" BETWEEN Access_Book_Gift.start_date AND Access_Book_Gift.expired_date AND (Book.book_platform_id=2 OR Book.book_platform_id IS NULL) AND Book.synthesizer_path IS NOT NULL AND Book.book_active=1 ) UNION ALL ( SELECT DISTINCT `Access_Book_Static`.`id` AS `access_id`, `Book`.`id` AS `book_id` FROM `ebs`.`ebs_access_book_static` `Access_Book_Static` INNER JOIN `ebs`.`ebs_packet_static` `Packet_Static` ON (Access_Book_Static.packet_static_id=Packet_Static.id AND "2024-11-06" BETWEEN Access_Book_Static.start_date AND Access_Book_Static.expired_date AND Access_Book_Static.subscriber_id IN (4)) INNER JOIN `ebs`.`ebs_packet_static_book_link` `Packet_Static_Book_Link` ON (Packet_Static_Book_Link.packet_static_id=Packet_Static.id) INNER JOIN `ebs`.`ebs_book` `Book` ON (Book.id=Packet_Static_Book_Link.book_id AND CONCAT(Book.book_expired," 23:59:59") >= Access_Book_Static.start_date) INNER JOIN `ebs`.`ebs_publisher` `Publisher` ON (Publisher.id=Book.publisher_id AND Publisher.publisher_active=1) INNER JOIN `ebs`.`ebs_book_category_link` `Book_Category_Link` ON (Book_Category_Link.book_id=Book.id) INNER JOIN `ebs`.`ebs_category` `Category` ON ((Category.id=Book_Category_Link.category_id) AND (Category.category_active=1)) INNER JOIN `ebs`.`ebs_category` `Area_Knowledge` ON (Area_Knowledge.id=Category.area_knowledge_id AND Area_Knowledge.area_knowledge_id=906 AND Area_Knowledge.category_active=1) INNER JOIN `ebs`.`ebs_packet_dynamic` `Packet_Dynamic` ON (Packet_Dynamic.category_id=Area_Knowledge.id AND Packet_Dynamic.publisher_id=Publisher.id) WHERE (Book.book_platform_id=2 OR Book.book_platform_id IS NULL) AND Book.synthesizer_path IS NOT NULL AND Book.book_private=0 AND Book.extra=1 AND Book.book_active=1 ) UNION ALL ( SELECT DISTINCT `Access_Book_Role`.`id` AS `access_id`, `Book`.`id` AS `book_id` FROM `ebs`.`ebs_access_book_role` `Access_Book_Role` INNER JOIN `ebs`.`ebs_access_role_action_link` `Access_Role_Action_Link` ON (Access_Role_Action_Link.access_role_id=Access_Book_Role.id) INNER JOIN `ebs`.`ebs_access_role_action` `Access_Role_Action` ON (Access_Role_Action_Link.access_role_action_id=Access_Role_Action.id AND Access_Role_Action.access_role_action_active=1) INNER JOIN `ebs`.`fos_user_group` `Group` ON (Group.id=Access_Book_Role.user_role_id) INNER JOIN `ebs`.`ebs_book` `Book` ON (Book.publisher_id=Access_Book_Role.publisher_id AND Book.book_private=0 AND Book.book_expired>"2024-11-06") INNER JOIN `ebs`.`ebs_publisher` `Publisher` ON (Publisher.id=Book.publisher_id AND Publisher.publisher_active=1) INNER JOIN `ebs`.`ebs_book_category_link` `Book_Category_Link` ON (Book_Category_Link.book_id=Book.id) INNER JOIN `ebs`.`ebs_category` `Category` ON ((Category.id=Book_Category_Link.category_id) AND (Category.category_active=1)) INNER JOIN `ebs`.`ebs_category` `Area_Knowledge` ON (Area_Knowledge.id=Category.area_knowledge_id AND Area_Knowledge.area_knowledge_id=906 AND Area_Knowledge.category_active=1) WHERE Group.roles='a:1:{i:0;s:10:"ROLE_STAFF";}' AND (Book.book_platform_id=2 OR Book.book_platform_id IS NULL) AND Book.synthesizer_path IS NOT NULL AND Book.book_active=1 ) UNION ALL ( SELECT DISTINCT `Access_Seb`.`id` AS `access_id`, `Book`.`id` AS `book_id` FROM `ebs`.`ebs_access_seb` `Access_Seb` INNER JOIN `ebs`.`ebs_seb` `Seb` ON ("2024-11-06" BETWEEN Access_Seb.start_date AND Access_Seb.expired_date AND Seb.id=Access_Seb.seb_id AND Access_Seb.subscriber_id IN (4)) INNER JOIN `ebs`.`ebs_seb_publisher_link` `Seb_Publisher_Link` ON (Seb_Publisher_Link.seb_id=Access_Seb.seb_id) INNER JOIN `ebs`.`ebs_publisher` `Net_Publisher` ON (Seb_Publisher_Link.publisher_id=Net_Publisher.id) INNER JOIN `ebs`.`ebs_publisher` `Book_Publisher` ON (Net_Publisher.id=Book_Publisher.publisher_id) INNER JOIN `ebs`.`ebs_book` `Book` ON (Book.publisher_id=Book_Publisher.id AND Book.book_private=0 AND Book.synthesizer_path IS NOT NULL) INNER JOIN `ebs`.`ebs_book_category_link` `Packet_Book_Category_Link` ON (Packet_Book_Category_Link.book_id=Book.id) INNER JOIN `ebs`.`ebs_category` `Packet_Category` ON (Packet_Category.id=Packet_Book_Category_Link.category_id AND Packet_Category.category_active=1) INNER JOIN `ebs`.`ebs_publisher` `Publisher` ON (Publisher.id=Book.publisher_id AND Publisher.publisher_active=1) INNER JOIN `ebs`.`ebs_book_category_link` `Book_Category_Link` ON (Book_Category_Link.book_id=Book.id) INNER JOIN `ebs`.`ebs_category` `Category` ON ((Category.id=Book_Category_Link.category_id) AND (Category.category_active=1)) INNER JOIN `ebs`.`ebs_category` `Area_Knowledge` ON (Area_Knowledge.id=Category.area_knowledge_id AND Area_Knowledge.area_knowledge_id=906 AND Area_Knowledge.category_active=1) INNER JOIN `ebs`.`ebs_packet_dynamic` `Packet_Dynamic` ON (Packet_Dynamic.category_id=Area_Knowledge.id AND Packet_Dynamic.publisher_id=Publisher.id) WHERE (Book.book_platform_id=2 OR Book.book_platform_id IS NULL) AND Book.synthesizer_path IS NOT NULL AND Book.book_active=1 )) `Available` ON (Available.book_id=Book.id) WHERE (Book.book_platform_id=2 OR Book.book_platform_id IS NULL) AND Book.synthesizer_path IS NOT NULL AND Book.book_active=1 GROUP BY `Publisher`.`id` HAVING (((expired>"2024-11-06" AND Book.book_private=0) OR available=1) AND all_count>0 ) ORDER BY available DESC, `Publisher`.`publisher_name` ASC LIMIT 10  ("") result: 'numRows' => 0, 'affectedRows' => 0, 'foundRows' => 0, 'insertId' => 

